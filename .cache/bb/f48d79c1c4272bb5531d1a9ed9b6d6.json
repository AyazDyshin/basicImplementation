{"id":"src6","dependencies":[{"name":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\login\\oidc\\redirectHandler\\IRedirectHandler.js.map","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\solid-client-authn-core\\src\\login\\oidc\\redirectHandler\\IRedirectHandler.ts","includedInParent":true,"mtime":499162500000},{"name":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\package.json","includedInParent":true,"mtime":1632614243327},{"name":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\solid-client-authn-core\\package.json","includedInParent":true,"mtime":1632612132798},{"name":"cross-fetch","loc":{"line":4,"column":30},"parent":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\login\\oidc\\redirectHandler\\IRedirectHandler.js","resolved":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\cross-fetch\\dist\\browser-ponyfill.js"},{"name":"@inrupt/jose-legacy-modules","loc":{"line":5,"column":38},"parent":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\login\\oidc\\redirectHandler\\IRedirectHandler.js","resolved":"C:\\Users\\Shadthepro\\Desktop\\my-demo-app\\node_modules\\@inrupt\\jose-legacy-modules\\dist\\index.browser.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.getWebidFromTokenPayload=exports.fetchJwks=void 0;const t=require(\"cross-fetch\"),e=require(\"@inrupt/jose-legacy-modules\");async function r(e,r){const o=await t.fetch(e);if(200!==o.status)throw new Error(`Could not fetch JWKS for [${r}] at [${e}]: ${o.status} ${o.statusText}`);let s;try{s=(await o.json()).keys[0]}catch(a){throw new Error(`Malformed JWKS for [${r}] at [${e}]: ${a.message}`)}return s}async function o(t,o,s,a){const i=await r(o,s);let n;try{const{payload:r}=await e.jwtVerify(t,await e.parseJwk(i),{issuer:s,audience:a});n=r}catch(c){throw new Error(`ID token verification failed: ${c.stack}`)}if(\"string\"==typeof n.webid)return n.webid;if(\"string\"!=typeof n.sub)throw new Error(`The ID token ${JSON.stringify(n)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(n.sub),n.sub}catch(c){throw new Error(`The ID token has no 'webid' claim, and its 'sub' claim of [${n.sub}] is invalid as a URL - error [${c}].`)}}exports.fetchJwks=r,exports.getWebidFromTokenPayload=o;"},"sourceMaps":{"js":{"mappings":[{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":126}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":132}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":134}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":28,"column":0},"generated":{"line":1,"column":142}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":157}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":159}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":29,"column":0},"generated":{"line":1,"column":167}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":53,"column":7},"generated":{"line":1,"column":198}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":53,"column":22},"generated":{"line":1,"column":213}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":215}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":55,"column":2},"generated":{"line":1,"column":217}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":61,"column":2},"generated":{"line":1,"column":220}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":61,"column":8},"generated":{"line":1,"column":226}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":61,"column":29},"generated":{"line":1,"column":234}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":61,"column":29},"generated":{"line":1,"column":236}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":61,"column":35},"generated":{"line":1,"column":242}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":62,"column":2},"generated":{"line":1,"column":245}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":62,"column":30},"generated":{"line":1,"column":248}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":62,"column":6},"generated":{"line":1,"column":254}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":62,"column":19},"generated":{"line":1,"column":256}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":1,"column":263}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":63,"column":10},"generated":{"line":1,"column":269}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":63,"column":14},"generated":{"line":1,"column":273}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":35},"generated":{"line":1,"column":308}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":53},"generated":{"line":1,"column":318}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":66},"generated":{"line":1,"column":325}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":79},"generated":{"line":1,"column":327}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":89},"generated":{"line":1,"column":337}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":64,"column":102},"generated":{"line":1,"column":339}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":68,"column":2},"generated":{"line":1,"column":353}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":68,"column":6},"generated":{"line":1,"column":357}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":69,"column":2},"generated":{"line":1,"column":359}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":70,"column":4},"generated":{"line":1,"column":363}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":70,"column":17},"generated":{"line":1,"column":372}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":70,"column":30},"generated":{"line":1,"column":374}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":70,"column":38},"generated":{"line":1,"column":382}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":70,"column":43},"generated":{"line":1,"column":387}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":71,"column":4},"generated":{"line":1,"column":390}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":71,"column":11},"generated":{"line":1,"column":396}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":72,"column":4},"generated":{"line":1,"column":399}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":72,"column":10},"generated":{"line":1,"column":405}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":72,"column":14},"generated":{"line":1,"column":409}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":73,"column":29},"generated":{"line":1,"column":438}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":73,"column":47},"generated":{"line":1,"column":448}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":73,"column":60},"generated":{"line":1,"column":455}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":73,"column":62},"generated":{"line":1,"column":457}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":76,"column":2},"generated":{"line":1,"column":468}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":76,"column":9},"generated":{"line":1,"column":475}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":88,"column":7},"generated":{"line":1,"column":477}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":88,"column":22},"generated":{"line":1,"column":492}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":89,"column":2},"generated":{"line":1,"column":494}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":90,"column":2},"generated":{"line":1,"column":496}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":91,"column":2},"generated":{"line":1,"column":498}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":92,"column":2},"generated":{"line":1,"column":500}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":94,"column":2},"generated":{"line":1,"column":503}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":94,"column":8},"generated":{"line":1,"column":509}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":94,"column":20},"generated":{"line":1,"column":517}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":94,"column":30},"generated":{"line":1,"column":519}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":94,"column":39},"generated":{"line":1,"column":521}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":95,"column":2},"generated":{"line":1,"column":524}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":95,"column":6},"generated":{"line":1,"column":528}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":96,"column":2},"generated":{"line":1,"column":530}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":97,"column":4},"generated":{"line":1,"column":534}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":97,"column":12},"generated":{"line":1,"column":540}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":97,"column":21},"generated":{"line":1,"column":548}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":97,"column":47},"generated":{"line":1,"column":557}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":97,"column":47},"generated":{"line":1,"column":559}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":98,"column":6},"generated":{"line":1,"column":569}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":99,"column":12},"generated":{"line":1,"column":577}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":99,"column":12},"generated":{"line":1,"column":579}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":99,"column":21},"generated":{"line":1,"column":588}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":100,"column":6},"generated":{"line":1,"column":591}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":101,"column":8},"generated":{"line":1,"column":592}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":101,"column":16},"generated":{"line":1,"column":599}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":102,"column":8},"generated":{"line":1,"column":601}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":102,"column":18},"generated":{"line":1,"column":610}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":105,"column":4},"generated":{"line":1,"column":614}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":105,"column":14},"generated":{"line":1,"column":616}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":106,"column":4},"generated":{"line":1,"column":618}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":106,"column":11},"generated":{"line":1,"column":624}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":107,"column":4},"generated":{"line":1,"column":627}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":107,"column":10},"generated":{"line":1,"column":633}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":107,"column":14},"generated":{"line":1,"column":637}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":107,"column":53},"generated":{"line":1,"column":676}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":107,"column":55},"generated":{"line":1,"column":678}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":110,"column":2},"generated":{"line":1,"column":687}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":110,"column":31},"generated":{"line":1,"column":690}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":110,"column":13},"generated":{"line":1,"column":707}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":110,"column":21},"generated":{"line":1,"column":709}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":111,"column":4},"generated":{"line":1,"column":715}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":111,"column":11},"generated":{"line":1,"column":722}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":111,"column":19},"generated":{"line":1,"column":724}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":113,"column":2},"generated":{"line":1,"column":730}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":113,"column":29},"generated":{"line":1,"column":733}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":113,"column":13},"generated":{"line":1,"column":750}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":113,"column":21},"generated":{"line":1,"column":752}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":114,"column":4},"generated":{"line":1,"column":756}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":114,"column":10},"generated":{"line":1,"column":762}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":114,"column":14},"generated":{"line":1,"column":766}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":115,"column":22},"generated":{"line":1,"column":788}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":115,"column":27},"generated":{"line":1,"column":793}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":116,"column":8},"generated":{"line":1,"column":803}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":120,"column":2},"generated":{"line":1,"column":865}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":126,"column":4},"generated":{"line":1,"column":869}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":125,"column":4},"generated":{"line":1,"column":876}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":125,"column":8},"generated":{"line":1,"column":880}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":125,"column":12},"generated":{"line":1,"column":884}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":125,"column":20},"generated":{"line":1,"column":886}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":126,"column":11},"generated":{"line":1,"column":891}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":126,"column":19},"generated":{"line":1,"column":893}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":127,"column":4},"generated":{"line":1,"column":897}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":127,"column":11},"generated":{"line":1,"column":903}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":128,"column":4},"generated":{"line":1,"column":906}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":128,"column":10},"generated":{"line":1,"column":912}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":128,"column":14},"generated":{"line":1,"column":916}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":129,"column":68},"generated":{"line":1,"column":984}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":129,"column":76},"generated":{"line":1,"column":986}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":129,"column":113},"generated":{"line":1,"column":1023}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":53,"column":0},"generated":{"line":1,"column":1031}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":53,"column":0},"generated":{"line":1,"column":1039}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":53,"column":0},"generated":{"line":1,"column":1049}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":88,"column":0},"generated":{"line":1,"column":1051}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":88,"column":0},"generated":{"line":1,"column":1059}},{"source":"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts","name":null,"original":{"line":88,"column":0},"generated":{"line":1,"column":1084}}],"sources":{"../../../../src/login/oidc/redirectHandler/IRedirectHandler.ts":"/*\n * Copyright 2021 Inrupt Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\n * Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/**\n * @hidden\n * @packageDocumentation\n */\n\n// eslint-disable-next-line no-shadow\nimport { fetch } from \"cross-fetch\";\nimport {\n  JWK,\n  JWTPayload,\n  jwtVerify,\n  parseJwk,\n} from \"@inrupt/jose-legacy-modules\";\nimport { EventEmitter } from \"events\";\nimport IHandleable from \"../../../util/handlerPattern/IHandleable\";\nimport { ISessionInfo } from \"../../../sessionInfo/ISessionInfo\";\n\nexport type RedirectResult = ISessionInfo & { fetch: typeof fetch };\nexport type RedirectInput = [string, EventEmitter | undefined];\n\n/**\n * @hidden\n */\ntype IRedirectHandler = IHandleable<\n  // Tuple of the URL to redirect to, an optional event listener for when\n  // we receive a new refresh token, and, an optional onError function:\n  RedirectInput,\n  RedirectResult\n>;\nexport default IRedirectHandler;\n\nexport async function fetchJwks(\n  jwksIri: string,\n  issuerIri: string\n): Promise<JWK> {\n  // FIXME: the following line works, but the underlying network calls don't seem\n  // to be mocked properly by our test code. It would be nicer to replace calls to this\n  // function by the following line and to fix the mocks.\n  // const jwks = createRemoteJWKSet(new URL(jwksIri));\n  const jwksResponse = await fetch(jwksIri);\n  if (jwksResponse.status !== 200) {\n    throw new Error(\n      `Could not fetch JWKS for [${issuerIri}] at [${jwksIri}]: ${jwksResponse.status} ${jwksResponse.statusText}`\n    );\n  }\n  // The JWKS should only contain the current key for the issuer.\n  let jwk: JWK;\n  try {\n    jwk = (await jwksResponse.json()).keys[0] as JWK;\n  } catch (e) {\n    throw new Error(\n      `Malformed JWKS for [${issuerIri}] at [${jwksIri}]: ${e.message}`\n    );\n  }\n  return jwk;\n}\n\n/**\n * Extract a WebID from an ID token payload based on https://github.com/solid/webid-oidc-spec.\n * Note that this does not yet implement the user endpoint lookup, and only checks\n * for `webid` or IRI-like `sub` claims.\n *\n * @param idToken the payload of the ID token from which the WebID can be extracted.\n * @returns a WebID extracted from the ID token.\n * @internal\n */\nexport async function getWebidFromTokenPayload(\n  idToken: string,\n  jwksIri: string,\n  issuerIri: string,\n  clientId: string\n): Promise<string> {\n  const jwk = await fetchJwks(jwksIri, issuerIri);\n  let payload: JWTPayload;\n  try {\n    const { payload: verifiedPayload } = await jwtVerify(\n      idToken,\n      await parseJwk(jwk),\n      {\n        issuer: issuerIri,\n        audience: clientId,\n      }\n    );\n    payload = verifiedPayload;\n  } catch (e) {\n    throw new Error(`ID token verification failed: ${e.stack}`);\n  }\n\n  if (typeof payload.webid === \"string\") {\n    return payload.webid;\n  }\n  if (typeof payload.sub !== \"string\") {\n    throw new Error(\n      `The ID token ${JSON.stringify(\n        payload\n      )} is invalid: it has no 'webid' claim and no 'sub' claim.`\n    );\n  }\n  try {\n    // This parses the 'sub' claim to check if it is a well-formed IRI.\n    // However, the normalized value isn't returned to make sure the WebID is returned\n    // as specified by the Identity Provider.\n    // eslint-disable-next-line no-new\n    new URL(payload.sub);\n    return payload.sub;\n  } catch (e) {\n    throw new Error(\n      `The ID token has no 'webid' claim, and its 'sub' claim of [${payload.sub}] is invalid as a URL - error [${e}].`\n    );\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"fd0b72460646b55d90eee6ec6cd53593","cacheData":{"env":{}}}